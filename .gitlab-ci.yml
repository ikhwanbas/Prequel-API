stages:
  - push
  - build
  - start

pushToServer:
  stage: push
  image: ubuntu
  script:
    - which ssh || apt update && apt install -y ssh
    - mkdir -p ~/.ssh # --> make a directory and search if ssh available
    - echo -e "Host *\n\tStrictHostKeyCheckingP no\n\n" > ~/.ssh/config 
    - chmod 400 $SSH_KEY
    - ssh -i "$SSH_KEY" $SSH_USERNAME@$SSH_ADDRESS "
      cd $CI_PROJECT_NAME &&
      git pull &&
      npm if &&
      pm2 restart server
      "

# build: # <-- Job
#   stage: build
#   image: ubuntu
#   script:
#     - echo "hello world!"